{"ast":null,"code":"import { NextApiRequest, NextApiResponse } from 'next';\nimport { AWS, poolData } from \"../../config\";\nexport default function signUp(req, res) {\n  if (req.method !== 'POST') {\n    res.status(405).json({\n      message: \"Method not allowed\"\n    });\n  } else {\n    const {\n      email,\n      password,\n      confirm_password\n    } = req.body;\n\n    if (password !== confirm_password) {\n      return;\n    }\n\n    const emailData = {\n      Name: 'email',\n      Value: email\n    };\n    let params = {\n      ClientId: poolData.ClientId,\n      Password: password,\n      Username: email,\n      UserAttributes: [emailData]\n    };\n    let CognitoIdentityServiceProvider = new AWS.CognitoIdentityServiceProvider();\n    CognitoIdentityServiceProvider.signUp(params, (err, data) => {\n      if (err) {\n        console.log(err, err.stack);\n      } else {\n        console.log(JSON.stringify(data));\n        params = {\n          GroupName: 'User',\n          UserPoolId: process.env.AWS_USER_POOL_ID,\n          Username: email\n        };\n        CognitoIdentityServiceProvider.adminAddUserToGroup(params, (err, data) => {\n          if (err) console.log(err, err.stack);else {\n            res.status(201);\n            console.log(data);\n            return;\n          }\n        });\n      }\n    });\n  }\n}","map":{"version":3,"sources":["/Users/azlinayeo/repos/next-cognito-spike/pages/api/signup.js"],"names":["NextApiRequest","NextApiResponse","AWS","poolData","signUp","req","res","method","status","json","message","email","password","confirm_password","body","emailData","Name","Value","params","ClientId","Password","Username","UserAttributes","CognitoIdentityServiceProvider","err","data","console","log","stack","JSON","stringify","GroupName","UserPoolId","process","env","AWS_USER_POOL_ID","adminAddUserToGroup"],"mappings":"AAAA,SAASA,cAAT,EAAyBC,eAAzB,QAAgD,MAAhD;AACA,SAASC,GAAT,EAAcC,QAAd,QAA8B,cAA9B;AAEA,eAAe,SAASC,MAAT,CAAgBC,GAAhB,EAAqBC,GAArB,EAA0B;AACrC,MAAID,GAAG,CAACE,MAAJ,KAAe,MAAnB,EAA2B;AACvBD,IAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,MAAAA,OAAO,EAAE;AAAV,KAArB;AACH,GAFD,MAEO;AACH,UAAM;AAAEC,MAAAA,KAAF;AAASC,MAAAA,QAAT;AAAmBC,MAAAA;AAAnB,QAAwCR,GAAG,CAACS,IAAlD;;AAEA,QAAIF,QAAQ,KAAKC,gBAAjB,EAAmC;AAC/B;AACH;;AAED,UAAME,SAAS,GAAG;AACdC,MAAAA,IAAI,EAAE,OADQ;AAEdC,MAAAA,KAAK,EAAEN;AAFO,KAAlB;AAKA,QAAIO,MAAM,GAAG;AACTC,MAAAA,QAAQ,EAAEhB,QAAQ,CAACgB,QADV;AAETC,MAAAA,QAAQ,EAAER,QAFD;AAGTS,MAAAA,QAAQ,EAAEV,KAHD;AAITW,MAAAA,cAAc,EAAE,CAACP,SAAD;AAJP,KAAb;AAOA,QAAIQ,8BAA8B,GAAG,IAAIrB,GAAG,CAACqB,8BAAR,EAArC;AACAA,IAAAA,8BAA8B,CAACnB,MAA/B,CAAsCc,MAAtC,EAA8C,CAACM,GAAD,EAAMC,IAAN,KAAe;AACzD,UAAID,GAAJ,EAAS;AACLE,QAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ,EAAiBA,GAAG,CAACI,KAArB;AACH,OAFD,MAGK;AACDF,QAAAA,OAAO,CAACC,GAAR,CAAYE,IAAI,CAACC,SAAL,CAAeL,IAAf,CAAZ;AAEAP,QAAAA,MAAM,GAAG;AACLa,UAAAA,SAAS,EAAE,MADN;AAELC,UAAAA,UAAU,EAAEC,OAAO,CAACC,GAAR,CAAYC,gBAFnB;AAGLd,UAAAA,QAAQ,EAAEV;AAHL,SAAT;AAKAY,QAAAA,8BAA8B,CAACa,mBAA/B,CAAmDlB,MAAnD,EAA2D,CAACM,GAAD,EAAMC,IAAN,KAAe;AACtE,cAAID,GAAJ,EAASE,OAAO,CAACC,GAAR,CAAYH,GAAZ,EAAiBA,GAAG,CAACI,KAArB,EAAT,KACK;AACDtB,YAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX;AACAkB,YAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;AACA;AACH;AACR,SAPG;AAQH;AACJ,KArBD;AAsBH;AAGJ","sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next';\nimport { AWS, poolData } from \"../../config\";\n\nexport default function signUp(req, res) {\n    if (req.method !== 'POST') {\n        res.status(405).json({message: \"Method not allowed\"})\n    } else {\n        const { email, password, confirm_password } = req.body;\n  \n        if (password !== confirm_password) {\n            return\n        }\n\n        const emailData = {\n            Name: 'email',\n            Value: email\n        };\n\n        let params = {\n            ClientId: poolData.ClientId,\n            Password: password,\n            Username: email,\n            UserAttributes: [emailData]\n        };\n\n        let CognitoIdentityServiceProvider = new AWS.CognitoIdentityServiceProvider();\n        CognitoIdentityServiceProvider.signUp(params, (err, data) => {\n            if (err) {\n                console.log(err, err.stack);\n            }\n            else {\n                console.log(JSON.stringify(data));\n\n                params = {\n                    GroupName: 'User',\n                    UserPoolId: process.env.AWS_USER_POOL_ID,\n                    Username: email,\n                }\n                CognitoIdentityServiceProvider.adminAddUserToGroup(params, (err, data) => {\n                    if (err) console.log(err, err.stack);\n                    else {\n                        res.status(201)\n                        console.log(data);\n                        return;\n                    }\n            })\n            }\n        });\n    }\n\n\n}"]},"metadata":{},"sourceType":"module"}
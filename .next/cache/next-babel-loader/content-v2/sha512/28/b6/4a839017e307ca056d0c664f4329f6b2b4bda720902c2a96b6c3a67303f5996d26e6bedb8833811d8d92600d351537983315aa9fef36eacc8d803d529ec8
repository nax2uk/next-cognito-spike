{"ast":null,"code":"import AWS from \"aws-sdk\";\nAWS.config.update({\n  accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n  secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\n  region: process.env.AWS_DEFAULT_REGION\n});\nconst poolData = {\n  UserPoolId: process.env.AWS_USER_POOL_ID,\n  ClientId: process.env.AWS_CLIENT_ID\n};\nconst content = \"<div className='govuk-grid-row'><div className='govuk-grid-column-full'><h1 className='govuk-heading-xl'>You have successfully signed up</h1></div></div>\";\nexport default function signUp(req, res) {\n  if (req.method !== 'POST') {\n    res.status(405).json({\n      error: \"Method not allowed\"\n    });\n  } else {\n    console.log(req.body);\n    const {\n      email,\n      password,\n      confirm_password\n    } = req.body;\n\n    if (password !== confirm_password) {\n      res.status(404);\n      res.end(JSON.stringify({\n        error: \"Password does not match\"\n      }));\n    }\n\n    const emailData = {\n      Name: 'email',\n      Value: email\n    };\n    let params = {\n      ClientId: poolData.ClientId,\n      Password: password,\n      Username: email,\n      UserAttributes: [emailData]\n    };\n    let CognitoIdentityServiceProvider = new AWS.CognitoIdentityServiceProvider();\n    CognitoIdentityServiceProvider.signUp(params, (err, data) => {\n      if (err) {\n        console.log(err, err.stack);\n        res.status(404);\n        res.end(JSON.stringify({\n          error: err.message\n        }));\n      } else {\n        console.log(JSON.stringify({\n          data\n        }));\n        params = {\n          GroupName: 'User',\n          UserPoolId: process.env.AWS_USER_POOL_ID,\n          Username: email\n        };\n        CognitoIdentityServiceProvider.adminAddUserToGroup(params, (err, data) => {\n          if (err) {\n            console.log(err, err.stack);\n            res.status(404);\n            res.end(JSON.stringify(err.message));\n          } else {\n            res.status(201);\n            console.log(data);\n            res.redirect(201, 'http://localhost:3000/signup-success'); //res.end(content);\n          }\n        });\n      }\n    });\n  }\n}","map":{"version":3,"sources":["/Users/azlinayeo/repos/next-cognito-spike/pages/api/signup.js"],"names":["AWS","config","update","accessKeyId","process","env","AWS_ACCESS_KEY_ID","secretAccessKey","AWS_SECRET_ACCESS_KEY","region","AWS_DEFAULT_REGION","poolData","UserPoolId","AWS_USER_POOL_ID","ClientId","AWS_CLIENT_ID","content","signUp","req","res","method","status","json","error","console","log","body","email","password","confirm_password","end","JSON","stringify","emailData","Name","Value","params","Password","Username","UserAttributes","CognitoIdentityServiceProvider","err","data","stack","message","GroupName","adminAddUserToGroup","redirect"],"mappings":"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","sourcesContent":["import AWS from \"aws-sdk\";\n\nAWS.config.update({\n  accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n  secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\n  region: process.env.AWS_DEFAULT_REGION,\n});\n\nconst poolData = {\n  UserPoolId:process.env.AWS_USER_POOL_ID,\n  ClientId:process.env.AWS_CLIENT_ID,\n};\nconst content=\"<div className='govuk-grid-row'><div className='govuk-grid-column-full'><h1 className='govuk-heading-xl'>You have successfully signed up</h1></div></div>\";\nexport default function signUp(req, res) {\n    if (req.method !== 'POST') {\n        res.status(405).json({error: \"Method not allowed\"})\n    } else {\n        console.log(req.body);\n        const { email, password, confirm_password } = req.body;\n  \n        if (password !== confirm_password) {\n            res.status(404);\n            res.end(JSON.stringify({error: \"Password does not match\"}))\n        }\n\n        const emailData = {\n            Name: 'email',\n            Value: email\n        };\n\n        let params = {\n            ClientId: poolData.ClientId,\n            Password: password,\n            Username: email,\n            UserAttributes: [emailData]\n        };\n\n        let CognitoIdentityServiceProvider = new AWS.CognitoIdentityServiceProvider();\n        CognitoIdentityServiceProvider.signUp(params, (err, data) => {\n            if (err) {\n                console.log(err, err.stack);\n                res.status(404);\n                res.end(JSON.stringify({error: err.message}))\n            }\n            else {\n                console.log(JSON.stringify({data}));\n\n                params = {\n                    GroupName: 'User',\n                    UserPoolId: process.env.AWS_USER_POOL_ID,\n                    Username: email,\n                }\n                CognitoIdentityServiceProvider.adminAddUserToGroup(params, (err, data) => {\n                    if (err) {\n                        console.log(err, err.stack);\n                        res.status(404);\n                        res.end(JSON.stringify(err.message))\n                    }\n                    else {\n                        res.status(201);\n                        console.log(data);\n                        res.redirect(201, 'http://localhost:3000/signup-success')\n                        //res.end(content);\n                    }\n                })\n            }\n        });\n    }\n}"]},"metadata":{},"sourceType":"module"}